<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive API Example</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>

    <h2>Google Drive API Example</h2>
    <button id="login-button">Login with Google</button>
    <button id="upload-button" style="display:none;">Upload File</button>
    <button id="list-files-button" style="display:none;">List Files</button>
    <ul id="file-list"></ul>

    <script type="text/javascript">
        // Client ID dari Google Cloud Console
        const CLIENT_ID = '813200627487-m1bte9iacbocsr0i8gqgbp5vudh495as.apps.googleusercontent.com'; // Ganti dengan Client ID milikmu 

        // ID API untuk Google Drive
        const API_KEY = 'AIzaSyBcx_GLOdIkHQ-9jKkAJGaXv4j13SNSTHg'; // Ganti dengan API Key milikmu

        // Scopes yang dibutuhkan untuk mengakses Drive
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        // Mendapatkan akses token dan memulai API
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                scope: SCOPES,
                discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
            }).then(function() {
                // Mendapatkan status login pengguna
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            });
        }

        // Memuat library API
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        // Menangani status login
        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                document.getElementById('login-button').style.display = 'none';
                document.getElementById('upload-button').style.display = 'inline-block';
                document.getElementById('list-files-button').style.display = 'inline-block';
            } else {
                document.getElementById('login-button').style.display = 'inline-block';
                document.getElementById('upload-button').style.display = 'none';
                document.getElementById('list-files-button').style.display = 'none';
            }
        }

        // Fungsi untuk login menggunakan Google
        function handleAuthClick(event) {
            gapi.auth2.getAuthInstance().signIn();
        }

        // Fungsi untuk logout
        function handleSignoutClick(event) {
            gapi.auth2.getAuthInstance().signOut();
        }

        // Fungsi untuk mengupload file ke Google Drive
        function uploadFile() {
            var fileContent = 'Hello, World!'; // Isi file yang ingin diupload
            var file = new Blob([fileContent], { type: 'text/plain' });

            var metadata = {
                name: 'sample.txt',
                mimeType: 'text/plain'
            };

            var accessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;
            var form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', file);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart');
            xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    alert('File uploaded successfully!');
                }
            };
            xhr.send(form);
        }

        // Fungsi untuk list file dari Google Drive
        function listFiles() {
            gapi.client.drive.files.list({
                'pageSize': 10,
                'fields': 'nextPageToken, files(id, name)'
            }).then(function(response) {
                var files = response.result.files;
                if (files && files.length > 0) {
                    var fileList = document.getElementById('file-list');
                    fileList.innerHTML = '';
                    files.forEach(function(file) {
                        var listItem = document.createElement('li');
                        listItem.textContent = file.name;
                        fileList.appendChild(listItem);
                    });
                } else {
                    alert('No files found.');
                }
            });
        }

        // Menambahkan event listener
        document.getElementById('login-button').addEventListener('click', handleAuthClick);
        document.getElementById('upload-button').addEventListener('click', uploadFile);
        document.getElementById('list-files-button').addEventListener('click', listFiles);

        // Memulai inisialisasi
        handleClientLoad();
    </script>

</body>
</html>
