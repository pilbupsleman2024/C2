<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive Shared Files</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>

    <h2>Daftar File dan Folder yang Dibagikan ke Saya</h2>
    <button id="login-button">Login with Google</button>
    <button id="list-files-button" style="display:none;">Lihat File Dibagikan</button>
    <ul id="file-list"></ul>

    <script type="text/javascript">
        // Client ID dari Google Cloud Console
        const CLIENT_ID = '813200627487-m1bte9iacbocsr0i8gqgbp5vudh495as.apps.googleusercontent.com'; // Ganti dengan Client ID milikmu

        // ID API untuk Google Drive
        const API_KEY = 'AIzaSyBcx_GLOdIkHQ-9jKkAJGaXv4j13SNSTHg'; // Ganti dengan API Key milikmu

        // Scopes yang dibutuhkan untuk mengakses Drive
        const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';

        // Mendapatkan akses token dan memulai API
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                scope: SCOPES,
                discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
            }).then(function() {
                // Mendapatkan status login pengguna
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            });
        }

        // Memuat library API
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        // Menangani status login
        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                document.getElementById('login-button').style.display = 'none';
                document.getElementById('list-files-button').style.display = 'inline-block';
            } else {
                document.getElementById('login-button').style.display = 'inline-block';
                document.getElementById('list-files-button').style.display = 'none';
            }
        }

        // Fungsi untuk login menggunakan Google
        function handleAuthClick(event) {
            gapi.auth2.getAuthInstance().signIn();
        }

        // Fungsi untuk logout
        function handleSignoutClick(event) {
            gapi.auth2.getAuthInstance().signOut();
        }

        // Fungsi untuk menampilkan file yang dibagikan ke saya
        function listSharedFiles() {
            gapi.client.drive.files.list({
                'q': "'me' in readers",  // Mencari file yang dibagikan dengan saya
                'fields': 'nextPageToken, files(id, name, mimeType, shared)',
                'spaces': 'drive'
            }).then(function(response) {
                var files = response.result.files;
                if (files && files.length > 0) {
                    var fileList = document.getElementById('file-list');
                    fileList.innerHTML = '';
                    files.forEach(function(file) {
                        var listItem = document.createElement('li');
                        listItem.textContent = file.name + ' (' + file.mimeType + ')';
                        fileList.appendChild(listItem);
                    });
                } else {
                    alert('Tidak ada file yang dibagikan kepada Anda.');
                }
            });
        }

        // Menambahkan event listener
        document.getElementById('login-button').addEventListener('click', handleAuthClick);
        document.getElementById('list-files-button').addEventListener('click', listSharedFiles);

        // Memulai inisialisasi
        handleClientLoad();
    </script>

</body>
</html>
